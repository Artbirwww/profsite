import React, { useState } from 'react';
import { Outlet, NavLink, useNavigate } from 'react-router-dom';
import { useAuth } from '../../contexts/AuthContext';
import './MainLayout.css';

const MainLayout: React.FC = () => {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);

  const handleLogout = () => {
    logout();
    navigate('/login');
  };

  const toggleSidebar = () => {
    setIsSidebarCollapsed(!isSidebarCollapsed);
  };

  // SVG иконки
  const TestsIcon = () => (
    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <g>
        <path d="m324.284 0h-208.284c-33.084 0-60 26.916-60 60v392c0 33.084 26.916 60 60 60h280c33.084 0 60-26.916 60-60v-320.284zm11.716 68.284 51.716 51.716h-31.716c-11.028 0-20-8.972-20-20zm60 403.716h-280c-11.028 0-20-8.972-20-20v-392c0-11.028 8.972-20 20-20h180v60c0 33.084 26.916 60 60 60h60v292c0 11.028-8.972 20-20 20z"/>
        <path d="m296 236h80v40h-80z"/>
        <path d="m296 356h80v40h-80z"/>
        <path d="m221.858 321.858-25.858 25.858-25.858-25.858-28.284 28.284 25.858 25.858-25.858 25.858 28.284 28.284 25.858-25.858 25.858 25.858 28.284-28.284-25.858-25.858 25.858-25.858z"/>
        <path d="m196 227.716-25.858-25.858-28.284 28.284 54.142 54.142 94.142-94.142-28.284-28.284z"/>
      </g>
    </svg>
  );

  const ResultsIcon = () => (
    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <g>
        <g>
          <g>
            <path d="M273.715,250.726c1.314,3.191,4.437,5.274,7.885,5.274h221.867c4.719,0,8.533-3.823,8.533-8.533 c0-70.289-20.941-126.865-62.234-168.166c-3.336-3.337-8.73-3.337-12.066,0c-3.336,3.336-3.336,8.73,0,12.066 c36.318,36.318,55.509,85.939,57.122,147.567H302.217l122.078-121.967c3.328-3.337,3.328-8.73,0-12.075 c-3.337-3.328-8.738-3.328-12.066,0L275.567,241.425C273.126,243.874,272.393,247.543,273.715,250.726z"/>
            <path d="M503.467,273.067c-4.719,0-8.533,3.823-8.533,8.533c0,118.758-87.441,209.007-204.8,213.18V290.133h179.2 c4.719,0,8.533-3.823,8.533-8.533s-3.814-8.533-8.533-8.533H281.6c-4.719,0-8.533,3.823-8.533,8.533v221.867 c0,4.71,3.814,8.533,8.533,8.533C412.954,512,512,412.954,512,281.6C512,276.89,508.186,273.067,503.467,273.067z"/>
            <path d="M398.566,79.3C361.651,42.377,310.144,0,238.933,0C107.179,0,0,107.179,0,238.933 c0,129.519,113.323,238.933,247.467,238.933c4.719,0,8.533-3.823,8.533-8.533s-3.814-8.533-8.533-8.533 c-124.894,0-230.4-101.606-230.4-221.867c0-122.334,99.524-221.867,221.867-221.867c61.227,0,107.418,35.285,141.483,68.309 L241.434,224.367c-1.604,1.596-2.5,3.772-2.5,6.033v204.8c0,4.71,3.814,8.533,8.533,8.533S256,439.91,256,435.2V233.933 L398.566,91.366C401.903,88.03,401.903,82.637,398.566,79.3z"/>
          </g>
        </g>
      </g>
    </svg>
  );

  const ProfileIcon = () => (
    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <g>
        <g>
          <g>
            <path d="M256.067,293.572c2.574,1.464,5.36,2.165,8.121,2.165c5.689,0,11.218-2.973,14.244-8.254 c4.482-7.863,1.757-17.865-6.106-22.356c-62.47-35.704-95.778-75.445-104.83-125.074c-4.02-22.081,0.648-54.785,20.11-78.117 c16.152-19.365,39.502-29.181,69.375-29.181c46.655,0,79.945,25.852,89.033,69.126c8.955,42.599-9.833,97.97-63.047,121.364 c-8.28,3.656-12.052,13.321-8.405,21.601c3.648,8.28,13.312,12.017,21.601,8.405c69.188-30.423,93.585-102.567,81.915-158.097 C368.414,49.149,331.53,0,256.981,0c-49.886,0-78.942,22.267-94.544,40.949c-28.045,33.618-32.18,77.557-27.184,104.972 C149.595,224.587,211.071,267.87,256.067,293.572z"/>
            <path d="M472.036,479.243H56.409c0.568-69.18,4.837-114.592,12.691-135.12c10.401-27.13,55.095-51.723,82.643-63.917 c26.793,54.154,87.116,162.401,89.911,167.415c1.527,2.736,3.778,4.915,6.432,6.37c0.055,0.03,0.109,0.06,0.164,0.089 c0.861,0.46,1.763,0.842,2.697,1.143c0.107,0.034,0.214,0.068,0.322,0.1c0.929,0.278,1.886,0.474,2.864,0.584 c0.113,0.013,0.226,0.024,0.339,0.034c0.493,0.045,0.988,0.076,1.488,0.076c0.004,0,0.007,0,0.011,0c0.002,0,0.005,0,0.007,0 c0.012,0,0.024-0.002,0.036-0.002c0.47-0.002,0.936-0.029,1.4-0.071c0.161-0.014,0.32-0.03,0.479-0.049 c0.361-0.043,0.72-0.098,1.075-0.164c0.26-0.048,0.516-0.105,0.772-0.166c0.25-0.059,0.498-0.121,0.744-0.191 c0.242-0.069,0.481-0.143,0.718-0.223c0.174-0.059,0.345-0.124,0.516-0.189c0.444-0.166,0.878-0.351,1.303-0.553 c0.129-0.062,0.26-0.121,0.387-0.186c0.256-0.13,0.506-0.267,0.754-0.41c0.117-0.067,0.23-0.139,0.345-0.21 c0.448-0.274,0.88-0.567,1.298-0.881c0.095-0.072,0.193-0.14,0.286-0.214c0.229-0.18,0.451-0.367,0.67-0.559 c0.096-0.084,0.189-0.171,0.283-0.257c0.724-0.665,1.387-1.392,1.982-2.177c0.027-0.036,0.054-0.071,0.08-0.107 c0.536-0.719,1.018-1.479,1.432-2.283c5.079-9.105,62.446-112.34,89.276-166.92c27.539,12.159,72.188,36.715,82.607,63.926 c10.224,26.625,9.682,58.21,9.203,86.086c-0.098,5.928-0.204,11.688-0.204,17.217c0,9.052,7.331,16.383,16.383,16.383 s16.392-7.331,16.392-16.383c0-5.352,0.089-10.916,0.195-16.649c0.541-30.867,1.145-65.843-11.369-98.396 c-19.915-52.016-105.904-84.986-115.648-88.571c-8.032-2.938-16.978,0.763-20.545,8.529 c-12.642,27.498-41.75,81.819-64.467,123.505v-48.007c0-9.052-7.331-16.383-16.383-16.383c-9.043,0-16.383,7.331-16.383,16.383 v48.158c-23.152-42.352-52.898-97.643-64.866-123.656c-3.568-7.774-12.496-11.466-20.545-8.529 c-9.736,3.585-95.715,36.556-115.657,88.562c-13.401,34.949-14.954,109.906-14.954,163.244c0,9.044,7.34,16.374,16.383,16.374 h432.073c9.052,0,16.401-7.322,16.401-16.374S481.089,479.243,472.036,479.243z"/>
          </g>
        </g>
      </g>
    </svg>
  );

  const menuItems = [
    { 
      to: '/dashboard',
      icon: <TestsIcon />, 
      text: 'Тесты',
      className: 'tests'
    },
    { 
      to: '/my-results', 
      icon: <ResultsIcon />, 
      text: 'Результаты',
      className: 'results'
    },
  ];

  return (
    <div className="main-layout-container">
      {/* Сайдбар с вашим дизайном */}
      <div className={`sidebar ${isSidebarCollapsed ? 'collapsed' : ''}`}>
        {/* Заголовок сайдбара с кнопкой сворачивания */}
        <div className="sidebar-header">
          {!isSidebarCollapsed && (
            <div className="sidebar-title">Меню</div>
          )}
          <button 
            className="sidebar-toggle"
            onClick={toggleSidebar}
            aria-label={isSidebarCollapsed ? "Раскрыть меню" : "Скрыть меню"}
          >
            <div className="toggle-icon">
              <div className="toggle-line"></div>
              <div className="toggle-line"></div>
              <div className="toggle-line"></div>
            </div>
          </button>
        </div>

        <ul className="nav-list">
          {menuItems.map((item, index) => (
            <li 
              key={item.to} 
              className={`nav-item ${item.className}`}
              style={{ '--item-index': index } as React.CSSProperties}
            >
              <NavLink
                to={item.to}
                className={({ isActive }) => 
                  `nav-link ${isActive ? 'active' : ''}`
                }
              >
                <span className="nav-icon">{item.icon}</span>
                {!isSidebarCollapsed && (
                  <span className="nav-text">{item.text}</span>
                )}
              </NavLink>
            </li>
          ))}

          {!isSidebarCollapsed && <div className="nav-separator"></div>}

          {/* Профиль пользователя */}
          {user && (
            <li 
              className="nav-item profile"
              style={{ '--item-index': menuItems.length } as React.CSSProperties}
            >
              <div className="nav-link">
                <span className="nav-icon"><ProfileIcon /></span>
                {!isSidebarCollapsed && (
                  <span className="nav-text">{user.email}</span>
                )}
              </div>
            </li>
          )}

          {/* Выход */}
          <li 
            className="nav-item logout"
            style={{ '--item-index': menuItems.length + 1 } as React.CSSProperties}
          >
          </li>
        </ul>
      </div>

      {/* Основное содержимое */}
      <div className={`main-content ${isSidebarCollapsed ? 'expanded' : ''}`}>
        <main className="main-content-inner">
          <Outlet />
        </main>
      </div>
    </div>
  );
};

export default MainLayout;