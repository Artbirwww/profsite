import React, { useState } from 'react';
import { Outlet, NavLink, useNavigate } from 'react-router-dom';
import { useAuth } from '../../contexts/AuthContext';
import './MainLayout.css';

const MainLayout: React.FC = () => {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);

  const handleLogout = () => {
    logout();
    navigate('/login');
  };

  const toggleSidebar = () => {
    setIsSidebarCollapsed(!isSidebarCollapsed);
  };

  // SVG иконки
  const TestsIcon = () => (
    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <g>
        <path d="m324.284 0h-208.284c-33.084 0-60 26.916-60 60v392c0 33.084 26.916 60 60 60h280c33.084 0 60-26.916 60-60v-320.284zm11.716 68.284 51.716 51.716h-31.716c-11.028 0-20-8.972-20-20zm60 403.716h-280c-11.028 0-20-8.972-20-20v-392c0-11.028 8.972-20 20-20h180v60c0 33.084 26.916 60 60 60h60v292c0 11.028-8.972 20-20 20z"/>
        <path d="m296 236h80v40h-80z"/>
        <path d="m296 356h80v40h-80z"/>
        <path d="m221.858 321.858-25.858 25.858-25.858-25.858-28.284 28.284 25.858 25.858-25.858 25.858 28.284 28.284 25.858-25.858 25.858 25.858 28.284-28.284-25.858-25.858 25.858-25.858z"/>
        <path d="m196 227.716-25.858-25.858-28.284 28.284 54.142 54.142 94.142-94.142-28.284-28.284z"/>
      </g>
    </svg>
  );

  const ResultsIcon = () => (
  <svg 
    viewBox="0 0 462.4 462.4" 
    xmlns="http://www.w3.org/2000/svg"
  >
    <g>
      <path 
        d="M452.178,210.7h-116.9c-2.7-13-8-26.5-15.2-37.5l82.7-83c27.2,33.1,45,74.6,49.4,119.6 C452.178,210,452.178,209.7,452.178,210.7z" 
        fill="#ffffffff"
      />
      <path 
        d="M396.778,254.7h55.3c-1.6,15.7-4.8,31-9.6,45.6h-0.1L396.778,254.7z" 
        fill="#ffffffff"
      />
    </g>
    <path 
      d="M442.378,300.3h0.1c-4.5,13.8-10.2,26.9-17.2,39.4l-0.2-0.1l-84.9-84.9h56.6L442.378,300.3z" 
      fill="#ffffffff"
    />
    <path 
      d="M425.078,339.6l0.2,0.1c-6.7,11.9-14.4,23.1-23.1,33.5l-0.2-0.2l-82.4-82.4c7.3-10.8,12.6-23,15.4-36 h5.2L425.078,339.6z" 
      fill="#ffffffff"
    />
    <path 
      d="M401.978,373.1l0.2,0.2c-8.5,10.3-18,19.8-28.3,28.4l-0.2-0.2l-82.3-82.5 c11.1-7.6,20.7-17.3,28.2-28.4L401.978,373.1z" 
      fill="#ffffffff"
    />
    <g>
      <path 
        d="M373.778,401.4l0.2,0.2c-10.4,8.7-21.6,16.5-33.5,23.2l-0.2-0.3l-87.1-87.1h-0.2v-1.9 c14-2.9,27-8.6,38.4-16.4L373.778,401.4z" 
        fill="#ffffffff"
      />
      <path 
        d="M371.878,59.3l-82.4,82.7c-10.9-7.2-23.8-12.4-37-15.1c-0.2,0-0.1-0.1-1.1-0.1V9.9c1,0,0.9,0,1.1,0 C297.478,14.3,338.778,32.1,371.878,59.3z" 
        fill="#ffffffff"
      />
    </g>
    <path 
      d="M340.378,424.5l0.2,0.3c-12.4,7-25.5,12.9-39.2,17.4l-0.1-0.2l-48.5-48.5l0.2-56.1h0.2L340.378,424.5 z" 
      fill="#ffffffff"
    />
    <path 
      d="M301.278,442l0.1,0.2c-15.4,5.1-31.6,8.6-48.3,10.2c-0.2,0-0.3,0-0.5,0.1l0.2-58.9L301.278,442z" 
      fill="#ffffffff"
    />
    <path 
      d="M209.178,334.3c0.2,0-0.8,117.1-0.8,117.1c-104-10.4-188-93.8-198.2-198.9l117.2-0.2 C135.878,293.3,168.178,325.6,209.178,334.3z" 
      fill="#ffffffff"
    />
    <path 
      d="M207.378,10.4v116.8c-40,8.7-71.3,42.5-79.8,83.5h-116.9C20.778,105.7,103.378,20.8,207.378,10.4z" 
      fill="#ffffffff"
    />
    <path 
      d="M410.478,83.9c-1.8-2.2-4.4-3.5-7.2-3.6c-2.8-0.1-5.6,0.9-7.6,2.9l-82.7,83c-3.3,3.4-3.9,8.6-1.3,12.5 c6.3,9.6,11.2,21.8,13.8,34.2c1,4.6,5.1,8,9.8,8h116.9c2.7,0,5.3-1.2,7.1-3.1s2.9-4.6,2.9-7.2c0-0.7,0-1.4-0.1-2.1 C457.478,162.5,439.678,119.4,410.478,83.9z M343.178,200.9c-2.6-9-6.1-18.1-10.5-26.1l69.2-69.4c20.7,28.1,34.1,60.5,39.1,95.5 H343.178z" 
      fill="#6b717f"
    />
    <path 
      d="M250.878,136.8c12,2.6,23.5,7.2,33.1,13.6c1.7,1.1,3.6,1.7,5.5,1.7c2.6,0,5.2-1,7.1-2.9l82.4-82.7c2-2,3-4.7,2.9-7.6 c-0.1-2.8-1.5-5.4-3.6-7.2c-35.6-29.3-78.7-47.1-124.6-51.6c-0.6-0.1-1.2-0.1-2-0.1c-2.7,0-5.3,1-7.2,2.9s-3,4.5-3,7.1v116.9 C241.378,132.1,245.578,136.5,250.878,136.8z M261.378,21.1c34.7,5,67.3,18.4,95.4,39.2l-68.9,69.2c-8.2-4.5-17.2-8.1-26.5-10.7 V21.1z" 
      fill="#6b717f"
    />
    <path 
      d="M10.678,220.9h116.9c4.7,0,8.8-3.4,9.8-8.1c7.8-37.6,36.8-68.1,72.1-75.8c4.6-1,7.9-5.1,7.9-9.8V10.4c0-2.8-1.2-5.5-3.3-7.4 s-4.9-2.8-7.7-2.5c-108.5,10.8-195,98.8-205.7,209.2c-0.3,2.8,0.7,5.7,2.5,7.8C5.178,219.6,7.778,220.9,10.678,220.9z M80.978,82.2 c31.7-32.3,72.6-53.6,116.4-60.4v97.8c-18.4,5.5-35.2,16-49,30.6c-13.6,14.3-23.4,31.8-28.7,50.8h-97.7 C28.578,155.9,49.278,114.5,80.978,82.2z" 
      fill="#6b717f"    />
    <path 
      d="M211.478,324.6c-0.1,0-0.1,0-0.2,0c-37.3-7.9-66.3-36.8-74.1-73.9c-1-4.6-5.1-7.7-9.8-7.7l0,0l-117.2-0.1 c-2.8,0-5.5,1.1-7.4,3.1c-1.9,2.1-2.8,4.8-2.5,7.6c10.6,109.5,97.7,196.8,207.1,207.8c0.3,0,0.7,0,1,0c2.5,0,4.8-0.9,6.7-2.6 c2.1-1.9,3.3-4.6,3.3-7.4c0,0,0.2-29.3,0.4-58.5c0.1-14.6,0.2-29.3,0.3-40.3c0-5.5,0.1-10.1,0.1-13.3c0-1.6,0-2.9,0-3.8 C219.178,327.6,214.278,325.3,211.478,324.6z M198.478,440.1c-44.1-6.8-85.4-27.7-117.3-59.7c-32-32.1-53-73.6-59.7-117.9l98-0.2 c10.9,38.5,41,68.7,79.6,79.8C199.078,359.6,198.778,404.3,198.478,440.1z" 
      fill="#6b717f"
    />
    <path 
      d="M452.078,244.9h-117c-4.7,0-8.8,3.2-9.8,7.8c-2.5,11.6-7.2,22.5-14,32.4c-6.8,10.1-15.4,18.8-25.6,25.7 c-10.6,7.3-22.3,12.3-34.8,14.9c-4.6,1-7.8,5-7.8,9.7l0.2,1.9l0,0l-0.7,115.1c0,2.9,1.1,5.6,3.2,7.5c1.8,1.6,4.2,2.5,6.6,2.5 c0.4,0,0.8,0,1.2-0.1c0.1,0,0.2,0,0.4,0c17.1-1.7,34.1-5.3,50.4-10.7c14.2-4.7,27.9-10.8,41-18.2c12.3-7,24.1-15.1,35-24.2 c10.7-9,20.6-18.9,29.5-29.6c9.1-10.9,17.2-22.7,24.1-35.1c7.3-13.1,13.4-27,18-41.2c5-15.5,8.4-31.5,10-47.7 c0.3-2.8-0.6-5.5-2.5-7.6C457.578,246,454.878,244.9,452.078,244.9z M437.478,281.4l-16.5-16.5h19.8 C439.878,269.9,438.778,276,437.478,281.4z M364.378,264.9h28.3l38.3,38.2c-2.4,6.8-5.2,13.5-8.3,20L364.378,264.9z M262.778,389.4 l0.1-28.2l61,61c-6.5,3.1-13.1,6-19.9,8.4L262.778,389.4z M270.778,340.8c6.7-2.4,13.1-5.4,19.3-9l69,69c-5.4,4.1-11,7.9-16.8,11.5 L270.778,340.8z M262.678,417.6l19.7,19.7c-6.5,1.6-13.1,2.9-19.8,3.9L262.678,417.6z M374.378,387.9l-67.8-67.8 c5.1-4.3,9.8-9.1,14.1-14.2l67.9,67.9C384.078,378.7,379.378,383.4,374.378,387.9z M401.278,358.2l-69-69c3.6-6.2,6.5-12.7,8.9-19.4 l71.5,71.5C409.178,347.1,405.378,352.8,401.278,358.2z" 
      fill="#6b717f"
    />
  </svg>
);

  const ProfileIcon = () => (
    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
      <g>
        <g>
          <g>
            <path d="M256.067,293.572c2.574,1.464,5.36,2.165,8.121,2.165c5.689,0,11.218-2.973,14.244-8.254 c4.482-7.863,1.757-17.865-6.106-22.356c-62.47-35.704-95.778-75.445-104.83-125.074c-4.02-22.081,0.648-54.785,20.11-78.117 c16.152-19.365,39.502-29.181,69.375-29.181c46.655,0,79.945,25.852,89.033,69.126c8.955,42.599-9.833,97.97-63.047,121.364 c-8.28,3.656-12.052,13.321-8.405,21.601c3.648,8.28,13.312,12.017,21.601,8.405c69.188-30.423,93.585-102.567,81.915-158.097 C368.414,49.149,331.53,0,256.981,0c-49.886,0-78.942,22.267-94.544,40.949c-28.045,33.618-32.18,77.557-27.184,104.972 C149.595,224.587,211.071,267.87,256.067,293.572z"/>
            <path d="M472.036,479.243H56.409c0.568-69.18,4.837-114.592,12.691-135.12c10.401-27.13,55.095-51.723,82.643-63.917 c26.793,54.154,87.116,162.401,89.911,167.415c1.527,2.736,3.778,4.915,6.432,6.37c0.055,0.03,0.109,0.06,0.164,0.089 c0.861,0.46,1.763,0.842,2.697,1.143c0.107,0.034,0.214,0.068,0.322,0.1c0.929,0.278,1.886,0.474,2.864,0.584 c0.113,0.013,0.226,0.024,0.339,0.034c0.493,0.045,0.988,0.076,1.488,0.076c0.004,0,0.007,0,0.011,0c0.002,0,0.005,0,0.007,0 c0.012,0,0.024-0.002,0.036-0.002c0.47-0.002,0.936-0.029,1.4-0.071c0.161-0.014,0.32-0.03,0.479-0.049 c0.361-0.043,0.72-0.098,1.075-0.164c0.26-0.048,0.516-0.105,0.772-0.166c0.25-0.059,0.498-0.121,0.744-0.191 c0.242-0.069,0.481-0.143,0.718-0.223c0.174-0.059,0.345-0.124,0.516-0.189c0.444-0.166,0.878-0.351,1.303-0.553 c0.129-0.062,0.26-0.121,0.387-0.186c0.256-0.13,0.506-0.267,0.754-0.41c0.117-0.067,0.23-0.139,0.345-0.21 c0.448-0.274,0.88-0.567,1.298-0.881c0.095-0.072,0.193-0.14,0.286-0.214c0.229-0.18,0.451-0.367,0.67-0.559 c0.096-0.084,0.189-0.171,0.283-0.257c0.724-0.665,1.387-1.392,1.982-2.177c0.027-0.036,0.054-0.071,0.08-0.107 c0.536-0.719,1.018-1.479,1.432-2.283c5.079-9.105,62.446-112.34,89.276-166.92c27.539,12.159,72.188,36.715,82.607,63.926 c10.224,26.625,9.682,58.21,9.203,86.086c-0.098,5.928-0.204,11.688-0.204,17.217c0,9.052,7.331,16.383,16.383,16.383 s16.392-7.331,16.392-16.383c0-5.352,0.089-10.916,0.195-16.649c0.541-30.867,1.145-65.843-11.369-98.396 c-19.915-52.016-105.904-84.986-115.648-88.571c-8.032-2.938-16.978,0.763-20.545,8.529 c-12.642,27.498-41.75,81.819-64.467,123.505v-48.007c0-9.052-7.331-16.383-16.383-16.383c-9.043,0-16.383,7.331-16.383,16.383 v48.158c-23.152-42.352-52.898-97.643-64.866-123.656c-3.568-7.774-12.496-11.466-20.545-8.529 c-9.736,3.585-95.715,36.556-115.657,88.562c-13.401,34.949-14.954,109.906-14.954,163.244c0,9.044,7.34,16.374,16.383,16.374 h432.073c9.052,0,16.401-7.322,16.401-16.374S481.089,479.243,472.036,479.243z"/>
          </g>
        </g>
      </g>
    </svg>
  );

  const menuItems = [
    { 
      to: '/dashboard',
      icon: <TestsIcon />, 
      text: 'Тесты',
      className: 'tests'
    },
    { 
      to: '/my-results', 
      icon: <ResultsIcon />, 
      text: 'Результаты',
      className: 'results'
    },
  ];

  return (
    <div className="main-layout-container">
      <div className={`sidebar ${isSidebarCollapsed ? 'collapsed' : ''}`}>
        <div className="sidebar-header">
          {!isSidebarCollapsed && (
            <div className="sidebar-title">Меню</div>
          )}
          <button 
            className="sidebar-toggle"
            onClick={toggleSidebar}
            aria-label={isSidebarCollapsed ? "Раскрыть меню" : "Скрыть меню"}
          >
            <div className="toggle-icon">
              <div className="toggle-line"></div>
              <div className="toggle-line"></div>
              <div className="toggle-line"></div>
            </div>
          </button>
        </div>

        <ul className="nav-list">
          {menuItems.map((item, index) => (
            <li 
              key={item.to} 
              className={`nav-item ${item.className}`}
              style={{ '--item-index': index } as React.CSSProperties}
            >
              <NavLink
                to={item.to}
                className={({ isActive }) => 
                  `nav-link ${isActive ? 'active' : ''}`
                }
              >
                <span className="nav-icon">{item.icon}</span>
                {!isSidebarCollapsed && (
                  <span className="nav-text">{item.text}</span>
                )}
              </NavLink>
            </li>
          ))}

          {!isSidebarCollapsed && <div className="nav-separator"></div>}

          {/* Профиль пользователя */}
          {user && (
            <li 
              className="nav-item profile"
              style={{ '--item-index': menuItems.length } as React.CSSProperties}
            >
              <NavLink
                to="/profile"
                className={({ isActive }) => 
                  `nav-link ${isActive ? 'active' : ''}`
                }
              >
                <span className="nav-icon"><ProfileIcon /></span>
                {!isSidebarCollapsed && (
                  <span className="nav-text">Личный кабинет</span>
                )}
              </NavLink>
            </li>
          )}

          {/* Выход */}
          <li 
            className="nav-item logout"
            style={{ '--item-index': menuItems.length + 1 } as React.CSSProperties}
          >
          </li>
        </ul>
      </div>

      {/* Основное содержимое */}
      <div className={`main-content ${isSidebarCollapsed ? 'expanded' : ''}`}>
        <main className="main-content-inner">
          <Outlet />
        </main>
      </div>
    </div>
  );
};

export default MainLayout;